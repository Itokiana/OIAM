<!-- call css  -->
<link rel="stylesheet" href="/css/be_processed.css" />
<!-- call css  -->
<!-- html body  -->
<div class="client-column">
	<div class="client-menu-left">
		<%= render partial: "admin_candidats/left_menu" %>
	</div>
	<div class="cp-box">
		<div class="admin-bp-box ">
			<div class="dp-input">

				<select name="filtre" id="filtre" class="co-select input-date-js">
					<option value=".TOUS" selected="selected">TOUS</option>
					<option value=".INSCRIPTION">INSCRIPTION</option>
					<option value=".COMPLETION_PROFIL">COMPLETION PROFIL</option>
					<option value=".PROMESSE-D-EMBAUCHE">PROMESSE D'EMBAUCHE</option>
					<option value=".PRIME">PRIME</option>
				</select>

				<!-- <br> -->

				<center style="display: none;">
					<table>
						<tr>
							<td>Date d'entrée : &nbsp;&nbsp;&nbsp;</td>
							<td><input type="date" name="enter_date_min" class="input-date-js" id="enter_date_min"></td>
							<td>&nbsp;&nbsp;&nbsp;à&nbsp;&nbsp;&nbsp;</td>
							<td><input type="date" name="enter_date_max" class="input-date-js" id="enter_date_max"></td>
						</tr>
						<tr>
							<td>Date limite : &nbsp;&nbsp;&nbsp;</td>
							<td><input type="date" name="lim_date_min" class="input-date-js" id="lim_date_min"></td>
							<td>&nbsp;&nbsp;&nbsp;à&nbsp;&nbsp;&nbsp;</td>
							<td><input type="date" name="lim_date_max" class="input-date-js" id="lim_date_max"></td>
						</tr>
					</table>
					<span class="btn btn-primary" id="delete_filter">Supprimer filtre</span>
				</center>

				<p id="none-element" style="display:none;">
					<br>
				Aucune tâche à traiter.</p>

			</div>
			<div class="flex">

				<!-- <div>Test potentiel non terminé (en cours d eroute),récupérer son nom et email)</div> -->

				<% unless @cadreInfoPotentielNotEnds.empty? %>
				<% @cadreInfoPotentielNotEnds.each do |cadreInfoPotentielNotEnd| %>
				
				<% minDate = cadreInfoPotentielNotEnd.created_at.strftime("%d/%m/%Y") %>

				<div data-name=".INSCRIPTION" class="bp-box list-items-me" data-min="<%= minDate %>" data-max="~">
					<!-- <img src='/image/profie.png'/> <br> -->
					<div class="bp-inside-box">
						<div class="bp-inscr">INSCRIPTION<br>
							Etat: Inscription non terminée
						</div>
						<div class="bp-name">
							<%= cadreInfoPotentielNotEnd.first_name %> <%= cadreInfoPotentielNotEnd.last_name %>
						</div>
						<div class="bp-date">
							Date d'entrée : <%= minDate %>
							
						</div>
						<div class="bp-date">
							Date limite :
							~
						</div>
					</div>
					<div class="bp-btn">
						<a href="<%= cbp_inscription_path(cadreInfoPotentielNotEnd.id) %>">GERER</a>
					</div>
				</div>
				<% end %>
				<% end %>

				<!-- <div>RDV Entretiens FIT à valider(nom+prenom, date+horaire rdv)</div> -->

				<% unless @cadreInfoFits.empty? %>
				<% @cadreInfoFits.each do |cadreInfoFit| %>


				<% minDate = cadreInfoFit.agenda_admin.entretien_date.strftime("%d/%m/%Y") %>

				<div data-name=".INSCRIPTION" class="bp-box list-items-me" data-min="<%= minDate %>" data-max="~">
					<div class="bp-inside-box">
						<div class="bp-inscr">INSCRIPTION<br>
							Etat: RDV FIT à valider
						</div>
						<div class="bp-name pt-4">
							<%= cadreInfoFit.first_name %> <%= cadreInfoFit.last_name %>
						</div>
						<div class="bp-date">
							Date d'entrée :
							<span
								data-times="<%= cadreInfoFit.agenda_admin.entretien_date.strftime("%Y-%m-%d %H:%M") %>"
								class="currentDatentretien"></span>
						</div>
						<div class="bp-date">
							Date limite :
							~
						</div>
					</div>
					<div class="bp-btn">
						<a href="<%= cbp_validate_entretien_fit_path(cadreInfoFit.id) %>">GERER</a>
					</div>
				</div>
				<% end %>
				<% end %>

				<!-- <div>Entretiens FIT à effectuer(nom+prénom+date)</div> -->

				<% unless @cadreInfoEnterScoreFits.empty? %>
				<% @cadreInfoEnterScoreFits.each do |cadreInfoEnterScoreFit| %>
					<% minDate = cadreInfoEnterScoreFit.agenda_admin.entretien_date.strftime("%d/%m/%Y") %>
					<div data-name=".INSCRIPTION" class="bp-box list-items-me" data-min="<%= minDate %>" data-max="~">
						<div class="bp-inside-box">
							<div class="bp-inscr">INSCRIPTION<br>
								Etat: Entretiens FIT à effectuer
							</div>
							<div class="bp-name pt-4">
								<%= cadreInfoEnterScoreFit.first_name %> <%= cadreInfoEnterScoreFit.last_name %>
							</div>
							<div class="bp-date">
								Date d'entrée :
								<span
									data-times="<%= cadreInfoEnterScoreFit.agenda_admin.entretien_date.strftime("%Y-%m-%d %H:%M") %>"
									class="currentDatentretien"></span>
							</div>
							<div class="bp-date">
								Date limite :
								~
							</div>
						</div>
						<div class="bp-btn">
							<a href="<%= post_avis_candidats_fit_path(cadreInfoEnterScoreFit.id) %>">GERER</a>
						</div>
					</div>
				<% end %>
				<% end %>

				<!-- <div>Profil non complété</div> -->

				<% unless @cacadreInfoInCompleteInfoProfils.empty? %>
				<% @cacadreInfoInCompleteInfoProfils.each do |cacadreInfoInCompleteInfoProfil| %>
				<% cfo = cacadreInfoInCompleteInfoProfil %>

				<% minDate = cfo.agenda_admin.created_at.strftime("%d/%m/%Y") %>
				<% maxDate = cfo.agenda_admin.created_at.next_day(7).strftime("%d/%m/%Y") %>

				<div data-name=".COMPLETION_PROFIL" class="bp-box list-items-me" data-min="<%= minDate %>" data-max="<%= maxDate %>">
					<div class="bp-inside-box">
						<div class="bp-inscr">COMPLETION PROFIL<br>
							Etat: Profil non complété
						</div>
						<div class="bp-name pt-4">
							<%= cfo.first_name %> <%= cfo.last_name %>
						</div>
						<div class="bp-date">
							Date d'entrée : <%= minDate %>
						</div>
						<div class="bp-date">
							Date limite : <%= maxDate %>
						</div>
					</div>
					<div class="bp-btn">
						<a href="<%= cbp_profil_no_complete_path(cacadreInfoInCompleteInfoProfil.id) %>">GERER</a>
					</div>
				</div>
				<% end %>
				<% end %>

				<!-- <div>Liste des candidats qui n'ont pas encore postulé à une offre ou qui ne sont pas dans un process de recrutement</div> -->

				<!-- <div>Liste des candidats qui n'ont pas eu de retour du recruteur suit au rdv déjà passé.</div> -->

				<!-- <div>Liste candidats qui ont eu une promesse d'embauche et qui n'ont pas répondu</div> -->

				<% unless @cadreInfoNotPromiseToHires.empty? %>
				<% @cadreInfoNotPromiseToHires.each do |cadreInfoNotPromiseToHire| %>
				<% cINPT = cadreInfoNotPromiseToHire.cadre_info %>
					<div data-name=".PROMESSE-D-EMBAUCHE" class="bp-box list-items-me" data-min="<%= cINPT.promise_not_reponded[1] %>" data-max="<%= cINPT.promise_not_reponded[0] %>">
						<div class="bp-inside-box">
							<div class="bp-inscr">PROMESSE D'EMBAUCHE<br>
								Etat: Promesse d'embauche non validée
							</div>
							<div class="bp-name pt-4">
								<%= cINPT.first_name %> <%= cINPT.last_name %>
							</div>
							<div class="bp-date">
								Date d'entrée : <%= cINPT.promise_not_reponded[1] %>
							</div>
							<div class="bp-date">
								Date limite : <%= cINPT.promise_not_reponded[0] %>
							</div>
						</div>
						<div class="bp-btn">
							<a href="<%= cbp_promise_no_validate_path(cINPT.id) %>">GERER</a>
						</div>
					</div>
				<% end %>
				<% end %>

				<!-- <div>Liste des candidats qui sont arrivés au bout de leur période d'essai et qui n'ont pas encore été validés dans le système.</div> -->

				<% unless @cadreInfoValidateTimeTryings.empty? %>
				<% @cadreInfoValidateTimeTryings.each do |cadreInfoValidateTimeTrying| %>

					<% pThWa = cadreInfoValidateTimeTrying[0] %>
					<% time_trying = pThWa.time_trying %>
					<% if time_trying.include?('-') %>
						<% ptime = time_trying.split('-')%>
						<% @pThWa1 = "#{ptime[2]}/#{ptime[1]}/#{ptime[0]}"%>
					<% else %>
						<% @pThWa1 =  time_trying %>
					<% end %>

					<div data-name=".PROMESSE-D-EMBAUCHE" class="bp-box list-items-me" data-min="<%= pThWa.offre_job.date_poste %>" data-max="<%= @pThWa1 %>">
						<div class="bp-inside-box">
							<div class="bp-inscr">PERIODE D'ESSAI<br>
								Etat: Période d'essai non validée
							</div>
							<div class="bp-name pt-4">
								<%= pThWa.cadre.cadre_info.first_name %> <%= pThWa.cadre.cadre_info.last_name %>
							</div>
							<div class="bp-date">
								Date d'entrée :
								<%= pThWa.offre_job.date_poste %>
							</div>
							<div class="bp-date">
								Date limite : <%= @pThWa1 %>
							</div>
						</div>
						<div class="bp-btn">
							<a href="<%= cbp_promise_no_validate_path(pThWa.cadre.cadre_info.id) %>">GERER</a>
							<!-- promise to hire -->
						</div>
					</div>

				<% end %>
				<% end %>

				<!-- <div>Liste des candidats qui n'ont pas reçu leur prime</div> -->

				<% unless @cadreInfoPrimNotReceiveds.empty? %>
				<% @cadreInfoPrimNotReceiveds.each do |cadreInfoPrimNotReceived| %>
					
					<% pThWa = cadreInfoPrimNotReceived[0] %>
					<% time_trying = pThWa.time_trying%>
					<%if time_trying.include?('-') %>
						<% ptime = time_trying.split('-')%>
						<% @pThWa1 = "#{ptime[2]}/#{ptime[1]}/#{ptime[0]}"%>
					<%else %>
						<% @pThWa1 =  time_trying %>
					<%end %>

					<div data-name=".PRIME" class="bp-box list-items-me" data-min="<%= pThWa.offre_job.date_poste %>" data-max="<%= @pThWa1 %>">
						<div class="bp-inside-box">
							<div class="bp-inscr">PRIME<br>
								Etat : Prime non reçue
							</div>
							<div class="bp-name pt-4">
								<%= pThWa.cadre.cadre_info.first_name %> <%= pThWa.cadre.cadre_info.last_name %>
							</div>
							<div class="bp-date">
								Date d'entrée : <%= pThWa.offre_job.date_poste %>
							</div>
							<div class="bp-date">
								Date limite : <%= @pThWa1 %>
							</div>
						</div>
						<div class="bp-btn">
							<a href="<%= cbp_prime_path(pThWa.id) %>">GERER</a>
						</div>
					</div>

				<% end %>
				<% end %>
			</div>

		</div>
	</div>
</div>


<script data-turbolinks-track="reload" type="text/javascript" src="/js/moment-js.js"></script>

<script type="text/javascript">

	$("#delete_filter").click(function(){
		$("#filtre").val(".TOUS")
		$("#enter_date_min").val("")
		$("#enter_date_max").val("")
		$("#lim_date_min").val("")
		$("#lim_date_max").val("")
		if ($('.list-items-me').length == 0){
			$("#none-element").fadeIn(500);
		}else{
			$('.list-items-me').fadeIn(500);
			$("#none-element").fadeOut(500);
		}
	});

	if ($('.list-items-me').length == 0){
		$("#none-element").fadeIn();
	}

	$(".currentDatentretien").ready(function () {
		let $elementDate = $('.currentDatentretien');
		$elementDate.each(function () {
			let dateUTC = moment.utc($(this).data().times);
			let dateGet = new Date(dateUTC.local());
			let dateString = dateGet.getDate() + "/" + (dateGet.getMonth()+1) + "/" + dateGet.getFullYear();
			$(this).html(dateString);
		});
	});

	$(".input-date-js").change(function(){
		run_filter();
	});

	function run_filter(){
		enter_date_min = $("#enter_date_min").val()
		enter_date_max = $("#enter_date_max").val()

		lim_date_min = $("#lim_date_min").val()
		lim_date_max = $("#lim_date_max").val()

		if(enter_date_min != ""){
			enter_date_min = new Date(enter_date_min)
		}

		if(enter_date_max != ""){
			enter_date_max = new Date(enter_date_max)
		}

		if(lim_date_min != ""){
			lim_date_min = new Date(lim_date_min)
		}

		if(lim_date_max != ""){
			lim_date_max = new Date(lim_date_max)
		}

		filter_select = $("#filtre").val()

		filterItems(enter_date_min,enter_date_max,lim_date_min,lim_date_max,filter_select);
	}

	function filterItems(enter_date_min="",enter_date_max="",lim_date_min="",lim_date_max="",filter_select=".TOUS"){

		let numberfadeOut = 0
		let $listElement = $(".list-items-me")

		$listElement.each(function(){
			let thisiko = $(this)
			let date_enter = thisiko.data().min
			let date_lim = thisiko.data().max
			if (date_enter.length > 3) {
				tmp_min = date_enter.split("/")
				date_enter = new Date(tmp_min[2], (tmp_min[1]-1), tmp_min[0]) 
			}
			if (date_lim.length > 3) {
				tmp_max = date_lim.split("/")
				date_lim = new Date(tmp_max[2], (tmp_max[1]-1), tmp_max[0]) 
			}
			if(enter_date_min == ""){

			}else{
				if (date_enter < enter_date_min){
					thisiko.fadeOut(500);
					numberfadeOut++;
					return;
				}else{
					thisiko.fadeIn(500);
				}
			}

			if(enter_date_max == ""){

			}else{
				if (date_enter > enter_date_max){
					thisiko.fadeOut(500);
					numberfadeOut++;
					return;
				}else{
					thisiko.fadeIn(500);
				}
			}

			if(lim_date_min == ""){

			}else{
				if (date_lim < lim_date_min){
					thisiko.fadeOut(500);
					numberfadeOut++;
					return;
				}else{
					thisiko.fadeIn(500);
				}
			}

			if(lim_date_max == ""){

			}else{
				if (date_lim > lim_date_max){
					thisiko.fadeOut(500);
					numberfadeOut++;
					return;
				}else{
					thisiko.fadeIn(500);
				}
			}

			if(filter_select == ".TOUS"){
				thisiko.fadeIn(500);
			}else{
				if (filter_select == thisiko.data().name) {
					thisiko.fadeIn(500);
				} else {
					thisiko.fadeOut(500);
					numberfadeOut++;
					return;
				}
			}
		});
		if ($listElement.length == numberfadeOut){
			$("#none-element").fadeIn(500);
		}else{
			$("#none-element").fadeOut(500);
		}
	}
</script>

<!-- 
fadeIn()
fadeOut() -->