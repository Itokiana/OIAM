<link rel="stylesheet" href="/css/client_profil.css" />
<link rel="stylesheet" href="/css/send_mess_cand.css" />
<script src="https://kit.fontawesome.com/d06d35ede2.js" crossorigin="anonymous"></script>
<div class="client-column">
  <div class="client-menu-left">
    <%= render partial: "admin_cadre/left_menu_link" %>
  </div>

  <div class="cp-box">
  	<div style="grid-column: 1">
  		<div class="fcp-box">
      <h3 class="title" style="color: #d6b36a !important">ENTRETIEN FIT</h3>
      <h3 class="title t2">Choisissez la suite a donner a ces candidats et rediger votre avis recruteur</h3>

      <div class="fc-item" style="display: flex; margin-top: 40px;">
        <div class="fc-item-all" style="margin-top: 40px;">


<!-- CANDIDATS  -->

          <div class="list-candidat">
            <div class="fci-image">
					    <% unless @cadre.image.nil? %>
                <%= image_tag(@cadre.image, alt: 'photo de profil')%>
              <% else %>
                <img src="/image/profie.png" alt="photo profil candidats">
              <% end %>
            </div>
            <div class="fci-icon">
              <% unless @cadre.admin.nil? %>
                <% if @cadre.admin == current_admin %>
                  <%= link_to rmv_favorite_cadre_path(id:@cadre.id), method: :delete, "data-confirm":"Êtes-vous sure de retirer cet(te) cadre de votre liste de candidat à suivre ?" do %>
                    <img src="/image/Vector-24.png" alt="logo oiam favorie" title="retirer" width="30px">
                  <% end %>
                <% else %>
                  <img src="/image/Vector-24.png" alt="logo oiam favorie" title="retirer" width="30px">
                <% end %>
              <% else %>
                <%= link_to add_favorite_cadre_path(id:@cadre.id), method: :post do %>
                  <img src="/image/Vector-22.png" alt="logo oiam non favorie" width="30px" title="suivre">
                <% end %>
              <% end %>
            </div>
            <div class="fci-infos">
              <p class="name"><%= @cadre.last_name %> <%= @cadre.first_name %></p>
              <p class="poste">Poste : <%= @cadre.job %></p>
              <p class="score">Score OIAM : <span><%= @cadre.score_potential %></span></p>
            </div>
          </div>
        </div>

         <!--  ---------------------------- -->


         <div class="mess_candidat">

          <% unless @cadre.agenda_admin.nil? %>          
            <% if @cadre.agenda_admin.entretien_date > DateTime.now.utc %>
              <p>
                <strong>Entretien fit avec ce cadre le : </strong>
                <span data-times="<%= @cadre.agenda_admin.entretien_date.strftime("%Y-%m-%d %H:%M") %>" class="currentDateEntretien"></span>
              </p>
              <p id="time-to-down" class="btn btn-info" style="font-size: 40px;"></p>
              <% if @cadre.agenda_admin.accepted.nil? %>
                <%= link_to accepted_or_reffused_path(id:@cadre.id), method: :post do %><br>ACCEPTER LE RENDEZ-VOUS<% end %>
              <% else %>
                <br>RENDEZ-VOUS ACCEPTER
              <% end %>

            <% else %>
              <% if @cadre.is_recrute.nil? %>
                <div style="margin-left: 200px; margin-top: 150px;">
                  <center>
                  <span style='font-size: 30px;' id="accepted-js" class="btn btn-primary btn-to-hidden-js">CANDIDATURE ACCEPTER</span><br><br>
                  <span style='font-size: 30px;' id="refused-js" class="btn btn-primary btn-to-hidden-js">CANDIDATURE REFFUSER</span>
                  </center>
                </div>

                <div id="show_if_accepted_js" style="display: none;">
                  <%= form_for Cadre.new , url: candidate_to_cadre_path do |f| %>
                    <input type="hidden" name="cadre_id" value="<%=@cadre.id%>" >
                    <input type="hidden" name="is_recrute" value="1" id="accept-js-wa">

                    <label for="avi_id_js">Avis de One in a million</label>
                    <div class="form-group">
                      <textarea id="avi_id_js" required="required" rows="3" class="form-control" name="avis" placeholder="avis visible par le client ..."></textarea>
                    </div>

                    <div class="row">
                      <div class="col-sm-6">
                        <label>Scors Fit</label>
                        <input type="number" name="score_fit">
                      </div>
                      <div class="col-sm-6">
                        <div class="form-group">
                          <%= f.label :compte_rendu, "Importer le compte rendu", class:"cv-label"%>
                          <%= f.file_field :compte_rendu, class:"form-control", accept:".doc,.docx,.pdf,application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document" %>
                        </div>
                      </div>
                    </div>
                    <div class="form-group">
                      <%= f.submit 'ENVOYER', :class => 'apercu' %>
                    </div>  
                  <% end %>
                </div>
              <% else %>
                <% if @cadre.is_recrute == true %>
                  <h2>CANDIDATURE ACCEPTER</h2>
                  <span class="btn btn-secondary">NOTIFIER PAR EMAIL</span>
                  <span id="generate-js" class="btn btn-secondary">Générer un lien</span>
                  <center id="show-link-js" style="display: none;">
                    Lien unique pour l'inscription du candidat: <br>
                    <strong><%= new_cadre_registration_path(comfirm:@cadre.confirm_token) %></strong>
                  </center>
                <% else %>
                  <h2>CANDIDATURE REFFUSER</h2>
                  <span class="btn btn-secondary">NOTIFIER PAR EMAIL</span>
                <% end %>
              <% end %>
            <% end %>
          <% else %>
            En attente de la proposition du date de l'entretien par le cadre.
          <% end %>

         </div>

        </div>
      </div>
    </div>
  	</div>
  </div>
</div>

<script type="text/javascript">
/*----------------------------------------------*/
  if (document.URL.indexOf('#') == -1) {
    url = document.URL + '#';
    location = '#';
    location.reload(true);
  }
/*----------------------------------------------*/
</script>

<script data-turbolinks-track="reload" type="text/javascript" src="/js/moment-js.js"></script>

<script type="text/javascript">
  var month = ['Janvier', 'Février', 'Mars', 'Avril', 'Mai', 'Juin', 'Juillet', 'Août', 'Septembre', 'Octobre', 'Novembre', 'Décembre'];
  var day = ['Dimanche', 'Lundi', 'Mardi', 'Mercredi', 'Jeudi', 'Vendredi', 'Samedi'];
  let $elementDate = $('.currentDateEntretien');

  $elementDate.each(function () {
    let dateUTC = moment.utc($(this).data().times);
    let dateGet = new Date(dateUTC.local());
    let dateString = day[dateGet.getDay()] + ' ' + dateGet.getDate() + ' ' + month[dateGet.getMonth()] + ' ' + dateGet.getFullYear();

    let heur = (""+dateGet.getHours()).length == 1 ? ("0"+dateGet.getHours()) : dateGet.getHours()
    let min = (""+dateGet.getMinutes()).length == 1 ? ("0"+dateGet.getMinutes()) : dateGet.getMinutes()

    $(this).html(dateString + ' à ' + heur + 'h:'+min);
  });

  $("#accepted-js").click(function(){
    $("#show_if_accepted_js").show(500);
    $(".btn-to-hidden-js").hide(500);
  });

  $("#refused-js").click(function(){
    $("#show_if_accepted_js").show(500);
    $(".btn-to-hidden-js").hide(500);
    $("#accept-js-wa").remove()
  });

  $("#generate-js").click(function(){
    $("#show-link-js").show(300);
  });

/*********************************************/
  let elementDate = $('.currentDateEntretien')[0];
  let dateUTC = moment.utc($(elementDate).data().times);
  let countDownDate = new Date(dateUTC.local()).getTime();
  var nodeTime = document.getElementById("time-to-down")
  var x = setInterval(function() {
    var now = new Date().getTime();
    var distance = countDownDate - now;
    var days = Math.floor(distance / (1000 * 60 * 60 * 24));
    var hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
    var minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
    var seconds = Math.floor((distance % (1000 * 60)) / 1000);
    nodeTime.innerHTML = days + "j:" + hours + "h:"
    + minutes + "m:" + seconds + "s";
    if (distance < 0) {
      clearInterval(x);
      nodeTime.innerHTML = "EXPIRED";
    }
  }, 1000);
/*********************************************/
</script>
